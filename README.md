# Проектная работа "Веб-ларек"

**Стек технологий:** HTML, SCSS, TypeScript, Webpack

## Структура проекта

- `src/` — исходные файлы проекта
  - `src/components/base/` — папка с базовым кодом
  - `src/pages/` — папка с HTML файлами
  - `src/types/` — папка с файлами типов
  - `src/utils/` — папка с утилитами

### Важные файлы

- `src/pages/index.html` — HTML-файл главной страницы
- `src/types/index.ts` — файл с типами
- `src/index.ts` — точка входа приложения
- `src/scss/styles.scss` — корневой файл стилей
- `src/utils/constants.ts` — файл с константами
- `src/utils/utils.ts` — файл с утилитами

## Установка и запуск

Для установки и запуска проекта выполните следующие команды:

```sh
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и их типы, используемые в приложении.

### Список продуктов
Данные о списке продуктов, загружаемых с сервера и доступных для пользователей, описываются следующим интерфейсом:
```typescript
 interface IProductList {
	total: number;
	items: IProductItem[];
	getCard(id: string): IProductItem;
}
```

### Карточка продукта
Этот интерфейс определяет структуру карточки продукта, которая содержит основную информацию о товаре.
```typescript
 interface IProductItem {
	id: string;
	description: string;
	image: string;
	title: string;
	category: string;
	price: number;
}
```
### Корзина

Блок, отвечающий за управление корзиной пользователя, где хранятся выбранные им продукты, описывается следующим интерфейсом:
```typescript
 interface IBasketModel {
	items: Map<string, number>;
	remove(id: string): void;
	resetBasket(): void;
	getTotal(): number;
	getTotalItems(): number;
  validBasket(value: string): boolean;
}
```
### Заказ
Интерфейс IOrderModel определяет структуру заказа:
```typescript
 interface IOrderModel {
	payment: TypeApiPayment;
	email: string;
	phone: string;
	address: string;
	total: number;
	items: string[];
  validOrder(value: string): boolean;
	resetOrder(): void;
}
```

### Ответ сервера при обработке заказа
Интерфейс IOrderResponse представляет информацию, возвращаемую сервером при успешной обработке заказа, включая уникальный идентификатор заказа и общую сумму:
```typescript
 interface IOrderResponse {
	id: number;
	total: number;
}
```
### Частичные модели данных заказа

Для удобства работы с данными заказа были определены три частичных интерфейса:

```typescript
 type PartialProductModel = Pick<IProductItem, 'id' | 'title' | 'price'>;
 type PartialUserContsctsModel = Pick<IOrderModel, 'email' | 'phone'>;
 type PartialUserPaymentsModel = Pick<IOrderModel, 'payment' | 'address'>;
```
Определяет доступные способы оплаты, в данном случае "наличные" и "онлайн". 
```typescript
type TypeApiPayment = 'cash' | 'online';
```
## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:
- слой данных, отвечает за хранение и изменение данных;
- слой представления, отвечает за отображение данных на странице;
- слой коммуникации, отвечает за связь представления и данных.
### Базовый код

#### Класс Api 
Содержит в себе базовую логику отправки запросов. 
- В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
- Методы: 

	- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер

	- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на них.  
- Основные методы реализуемые классом описаны интерфейсом `IEvents`:
	- `on` - подписка на событие
	- `emit` - инициализация события
	- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие 

### Слой данных
---

#### Класс CatalogService
 Отвечает за хранение и управление данными каталога продуктов.
 - Конструктор класса принимает инстант брокера событий

- Поля класса хранят следующие данные:
	- `total` - количество продуктов в каталоге
	- `items` - каталог с продуктами
	- `events` - экземпляр класса `EventEmitter`.

- Методы для взаимодействия с данными:

	-  метод `getCard` для получения информации о конкретном продукте.

#### Класс ProductService
Отвечает за управление данными карточки продукта при добавлении в корзину.

- Конструктор класса принимает инстант брокера событий

- Поля класса хранят следующие данные:
	- `id` - уникальный идентификатор карточки
	- `title` - название карточки
	- `price` - цена.

- Методы для взаимодействия с данными:

	- `addToBasket()`, который добавляет карточку в корзину, 

####  Класс BasketService
 Отвечает за хранение и управление данными корзины пользователя
- Конструктор класса принимает инстант брокера событий

- Поля класса хранят следующие данные:
 	- `items` - список карточек товара добавленных пользователем.
 	- `total` - общую стоимость всех карточек.
	- `events` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

- Методы для взаимодействия с данными:
	- `remove` - удаляет товар из корзины.
	- `resetBasket` - очищает корзину.
	- `getTotal` - получает общую сумму корзины.
	- `getTotalItems` - получает общее количество товаров в корзине.
	- `validBasket` - проверяет корректность данных корзины.

#### Класс OrderService
Отвечает за хранение и управление данными заказа.
- Конструктор класса принимает инстант брокера событий

- Поля класса хранят следующие данные:
	- `payment` - способ оплаты.
	- `email` - почта клиента.
	- `phone` - телефонный номер клиента.
	- `address` - адрес клиента.
	- `total` - сумма заказа.
	- `items` - массив с id карточек товара.
	- `events` - экземпляр класса `EventEmitter`.

- Предоставляет методы:
	- `validOrder` для проверки валидности заказа.
	- `resetOrder` для очистки данных заказа.


####  Класс UserContactsService
 Класс для управления контактными данными пользователя.
- Конструктор класса принимает инстант брокера событий

- Поля класса хранят следующие данные:
	- `payment` - способ оплаты.
	- `email` - почта клиента.
	- `phone` - телефонный номер клиента.
	- `address` - адрес клиента.
	- `events` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

### Слой представления
---

####  Класс Page 
Отвечает за отображение блока с карточками на главной странице. 

- Поля класса:
	- `total` - число товаров в корзине
	- `containerCard` - контейнер для продуктов
	- `basket` - иконка корзины.

- Методы:
	- `set productsCard`: добавляет карточки продуктов на страницу.
	- `set totalProductsBasket`: добавляет количество продуктов в корзине в иконку отображения.


####  Класс Card 
Отвечает за отображение карточки продукта.
- Конструктор: принимает темплейт элемент и экземпляр EventEmitter.

- Поля:

	- `title` - элемент заголовка карточки
	- `category` - элемент категории карточки
	- `price` - элемент цены карточки
	- `image` - элемент картинки карточки
	- `description` - элемент описания карточки
	- `button` - элемент кнопки карточки

- Сеттеры:

	- `id` - задает id карточки
	- `title` - содержимое заголовка
	- `category` - категория товара
	- `price` - содержимое контейнера с ценой 
	- `image` - изображения товара
	- `description` - описание
	- `button` - устанавливает текст на кнопке

	
- Геттер:
	- `id`: возвращает уникальный ID карточки.

- Методы:
	- `render(data: IProductItem)`: отображает данные карточки продукта.
	- `addToBasket()`: добавляет карточку в корзину.

#### Класс Basket 
Отвечает за отображение корзины в модальном окне.

- Конструктор: принимает контейнер для поиска и объект для работы с событиями.

- Поля:

	- `productItems` - коллекция карточек
	- `total` - сумма всех продуктов
	- `button` - кнопка оформления заказа в корзине

- Сеттеры:
	- `items` - меняет содержимое в корзине в зависимости от переданных товаров
	- `total` - меняет значение в элементе суммы товаров на переданное

- Методы:
	- `removeItem(id: string)`: удаляет карточку товара из корзины.
	- `updateTotal()`: обновляет общую стоимость товаров в корзине.
	- `render()`: обновляет количество товаров в корзине.
	- `validButton()`: работает с состоянием кнопки.

#### Класс Modal
Реализует модальное окно.

- Конструктор: принимает селектор и экземпляр EventEmitter.

- Поля:
	- `closeModal` - элемент кнопки закрытия модального окна
	- `content` - элемент с содержимым модального окна

- Методы:
	- `open()`: открывает модальное окно.
	- `close()`: закрывает модальное окно.
	- `render()` - рендерит окно с переданным в него содержимым

- Геттеры:
	- `closeModal`: получает кнопку закрытия модального окна.
	- `modalContent`: получает темплейт элемент модального окна.

#### Класс Form 
Отвечает за модальное окно с формой.

- Поля:
	- `submitButton`: HTML-кнопка подтверждения.
	- `form`: HTML-элемент формы.

- Конструктор: принимает темплейт элемент и экземпляр EventEmitter.

- Методы:
	- `showErrors(errors: { [key: string]: string })`: отображает ошибки валидации.
	- `enableSubmitButton()`: активирует кнопку подтверждения.
	- `disableSubmitButton()`: деактивирует кнопку подтверждения.
	- `getFormData()`: получает данные из полей формы.
	- `errors`: элемент для отображения ошибок валидации.

#### Класс UserContact 
Отвечает за отображение формы контактных данных пользователя.

- Конструктор: принимает темплейт элемент и экземпляр EventEmitter.

- Поля:
	- `userEmail` - поле ввода почты
	- `userTell` - поле ввода телефона

- Сеттеры:
	- `email` - содержимое поля email 
	- `tell` - содержимое поля телефона

- Геттеры:
	- `emailInput`: поле ввода email.
	- `tellInput`: поле ввода телефона.


- Методы:
	- `render(data: PartialUserContactsModel)`: отображает данные контактов пользователя.
	- `getFormData()`: получает данные из полей формы контактов.
	

#### Класс OrderPayment 
Отвечает за отображение формы данных для оформления заказа.

- Конструктор: принимает темплейт элемент и экземпляр EventEmitter.

- Поля:
	- `payment` - кнопка выбора оплаты
	- `address` - поле ввода с адресом

- Сеттеры:
	- `payment` - типа оплаты
	- `address` - содержимое поля с адресом

- Геттеры:
	- `paymentSelected`: список способа оплаты.
	- `addressInput`: поле ввода адреса.

- Методы:
	- `render(data: PartialUserPaymentsModel)`: отображает данные для оформления заказа.
	- `getFormData()`: получает данные из полей формы оформления заказа.


#### Класс OrderSuccess 
Отвечает за отображение модального окна об успешной оплате.

- Конструктор: принимает название блока, контейнер для поиска и объект для работы с событиями.

- Сеттер:
	- `set total()`: устанавливает сумму заказа.

- Поля:
	- `total`: общая сумма заказа.
	- `closeButton`: кнопка закрытия модального окна.

## Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

### Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

### Список всех событий, которые могут генерироваться в системе

- События изменения данных (генерируются классами моделями данных)

	- `cards:changed` - изменение массива карточек
	- `card:selected` - выбрана карточка для просмотра в модальном окне

- События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)

	- `modal:open` - открытие модального окна
	- `modal:close` - закрытие модального окна
	- `basket:addProduct` - добавление товара в корзину
	- `basket:changed` - изменения в корзине 
	- `productItem:delete` - удаление товара из корзины в модальном окне товара
	- `basket:deleteproduct` - удаление товара из корзины
	- `payment:select` - пользователь выбрал способа оплаты
	- `form:submit` - пользовавтель отправил форму
	- `form-contacts:submit` - сохранение данных пользователя в модальном окне
	- `form-payment:submit` - сохранение адреса и способа оплаты в модальном окне
	- `edit-contacts:input` - изменение данных в форме с данными пользователя
	- `edit-adress:input` - изменение данных в форме с адрессом пользователя
	- `edit-contacts:validation` - событие, сообщающее о необходимости валидации формы контактов пользователя
	- `edit-adress:validation` - событие, сообщающее о необходимости валидации формы с адрессом
	- `basket:validation` - событие, сообщающее о необходимости валидации корзины
	- `formErrors:change` - ошибки валидации